{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Dashboard{% endblock %}
{% block content %}

<!-- List All Rural Producers -->
<div id="ruralproducerlist" class="content-section py-5">
  <div class="container">
    <h2 class="mb-4 text-center">Rural Producer List</h2>
    <div class="table-responsive">
      <table class="table table-striped table-bordered">
        <thead class="table-dark">
          <tr>
            <th>Name</th>
            <th>CPF/CNPJ</th>
            <th>City</th>
            <th>State</th>
            <th>Farm Name</th>
            <th>Farm Area</th>
            <th>Vegetation Area</th>
            <th>Plantable Area</th>
            <th>Crops</th>
            <th>Actions</th> <!-- Added Actions column -->
          </tr>
        </thead>
        <tbody>
          {% for rural_producer in rural_producers %}
          <tr>
            <td>{{ rural_producer.name }}</td>
            <td>{{ rural_producer.cpf_cnpj }}</td>
            <td>{{ rural_producer.farm.city }}</td>
            <td>{{ rural_producer.farm.state }}</td>
            <td>{{ rural_producer.farm.farm_name }}</td>
            <td>{{ rural_producer.farm.farm_area }}</td>
            <td>{{ rural_producer.farm.vegetation_area }}</td>
            <td>{{ rural_producer.farm.plantable_area }}</td>
            <td>
              {% if rural_producer.farm.crops.all %}
                <ul class="list-unstyled">
                  {% for crop in rural_producer.farm.crops.all %}
                    <li>{{ crop.crop_plantation }}</li>
                  {% endfor %}
                </ul>
              {% else %}
                No crops available
              {% endif %}
            </td>
            <td>
              <!-- Edit and Delete Buttons -->
              <a href="{% url 'ruralproducer-edit' rural_producer.id %}" class="btn btn-warning btn-sm">Edit</a>
              <form action="{% url 'ruralproducer-delete' rural_producer.id %}" method="post" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this item?');">Delete</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page=1" aria-label="First">
              <span aria-hidden="true">&laquo;&laquo;</span>
            </a>
          </li>
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}" aria-label="Previous">
              <span aria-hidden="true">&laquo;</span>
            </a>
          </li>
        {% endif %}
        <li class="page-item disabled">
          <span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
        </li>
        {% if page_obj.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}" aria-label="Next">
              <span aria-hidden="true">&raquo;</span>
            </a>
          </li>
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}" aria-label="Last">
              <span aria-hidden="true">&raquo;&raquo;</span>
            </a>
          </li>
        {% endif %}
      </ul>
    </nav>
  </div>
</div>

{% endblock %}
